{% extends "base.html" %}

{% import "macros/element.html" as Element %}
{% import "macros/form.html" as Form %}

{% block page_heading %}
  {% if session.has_partner %}
    You and your partner’s property
  {% else %}
    Your property
  {% endif %}
{% endblock %}

{% block inner_content %}

  {% if session.has_partner %}
    <p>Please tell us about any property owned by you, your partner or both of you.</p>
    <p>If you or your partner own more than one property, you can add more properties below.</p>
  {% else %}
    <p>If you own more than one property, you can add more properties below.</p>
  {% endif %}

  <form method="POST" action="{{ url_for('.property') }}">
    {{ form.csrf_token }}
    {{ Form.handle_errors(form) }}

    {% for property in form.properties %}
      <fieldset id="property-set-{{loop.index}}">
        {% if form.properties|count > 1 %}
          <header>
            <h3>Property {{loop.index}}</h3>
            {% if loop.index != 1 %}
              <button class="button-secondary button-small" name="remove-property" value="{{loop.index0}}">
                Remove property
              </button>
            {% endif %}
          </header>
        {% endif %}

        {{ Form.yesno_field(property.is_main_home) }}
        {{ Form.yesno_field(property.other_shareholders) }}
        {{ Form.text_field(property.property_value, prefix="£", class_='m-small') }}
        {{ Form.text_field(property.mortgage_remaining, prefix="£", class_='m-small') }}
        {{ Form.text_field(property.mortgage_payments, prefix="£", class_='m-small') }}
        {% call Form.yesno_field(property.is_rented, subfield=property.rent_amount) %}
          {{ Form.money_interval_field(property.rent_amount, group_class='form-subfield s-hidden') }}
        {% endcall %}
        {{ Form.yesno_field(property.in_dispute) }}
      </fieldset>
    {% endfor %}

    {% if form.properties|count < 3 %}
      <p>
        <button class="button-secondary button-large" name="add-property">Add another property</button>
      </p>
    {% endif %}

    {{ Element.call_me_back_link() }}

    {{ Form.honeypot(form) }}
    {{ Form.actions('Continue') }}
  </form>

  <script>
    window.CONDITIONAL_LABELS = {
      'properties-0-rent_amount': 'How much rent do they pay you?',
      'properties-1-rent_amount': 'How much rent do they pay you?',
      'properties-2-rent_amount': 'How much rent do they pay you?'
    };
  </script>
{% endblock %}
