{% extends "checker/base.html" %}

{% macro option_list_callback(field, option) %}
  {% if option.data == 'child_benefit' %}

    {{ Form.money_interval_fieldset(form.child_benefit, is_subfield=True, controlled_by=option, control_value=option.data) }}

  {% elif option.data == 'other-benefit' %}

    {% call Form.fieldset(
      controlled_by=field,
      control_value=option.data,
      is_subfield=True,
      has_label=False,
      has_info=False,
      use_row=False
    ) %}
      <fieldset
        class="fieldset-group {%- if form.other_benefits.errors %} m-error{% endif %}"
        id="field-{{ form.other_benefits.id }}">
        <legend
          class="fieldset-label {%- if form.other_benefits.errors %} m-error{% endif %}"
          id="field-label-{{ form.other_benefits.id }}">
          <span>{{ form.other_benefits.label.text }}</span>
        </legend>
        <div class="form-row">
          <ul class="non-income-benefits-list">
            {% for other_benefit in form.get_non_income_benefits() %}
              <li>{{ other_benefit }}</li>
            {% endfor %}
          </ul>
        </div>
        <div class="form-row field-help">
          <span class="field-description">
            {{- form.other_benefits.description -}}
          </span>
        </div>
        <div class="form-row">
          {{ Form.radio_buttons(form.other_benefits) }}
        </div>
      </fieldset>

      {{ Form.money_interval_fieldset(
        form.total_other_benefit, class_='fieldset-group',
        controlled_by=form.other_benefits,
        control_value=1,
      )}}

    {% endcall %}

  {% endif %}
{% endmacro %}

{% block inner_content %}
  <h1>{{ title }}</h1>

  <form method="POST">
    {{ form.csrf_token }}
    {{ Form.handle_errors(form) }}

    {{ Form.option_list_fieldset(form.benefits, separated_options=['other-benefit'], callback=option_list_callback) }}

    {{ Element.get_in_touch_alert() }}

    {{ Form.honeypot(form) }}
    {{ Form.actions(_('Continue')) }}
  </form>
{% endblock %}

{% block javascripts %}
  {{ super() }}

  <script>
    window.CONDITIONAL_LABELS = {
      'child_benefit': '{{ _('Enter the total amount you receive') }}',
      'total_other_benefit': '{{ _('Enter the total amount you receive') }}'
    };
 </script>
{% endblock %}
